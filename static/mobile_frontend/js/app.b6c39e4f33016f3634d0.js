webpackJsonp([6],{"0RrJ":function(e,t,n){"use strict";var r=n("mtWM").a.create({baseURL:"http://127.0.0.1",timeout:5e3});r.interceptors.request.use(function(e){return e},function(e){return e}),r.interceptors.response.use(function(e){return e.data},function(e){return e}),t.a=r},"59kE":function(e,t,n){"use strict";t.b=function(e){return s.a.get("/file_size/"+e)},n.d(t,"a",function(){return c});var r=n("Xxa5"),a=n.n(r),u=n("exGp"),i=n.n(u),s=n("0RrJ");var o,c=(o=i()(a.a.mark(function e(t,n,r,u,i){var o,c,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=d?"/download/"+t+"?hit_log=true":"/download/"+t,e.next=3,s.a.post(o,{secret_key:n,ciphertext:r},{headers:{Range:"bytes="+u+"-"+i},responseType:"blob"});case 3:if(void 0==(c=e.sent).errno){e.next=6;break}return e.abrupt("return",{succed:!1,data:null});case 6:if(!(!c instanceof Blob)){e.next=8;break}return e.abrupt("return",{succed:!1,data:null});case 8:return e.abrupt("return",{succed:!0,data:c});case 9:case"end":return e.stop()}},e,this)})),function(e,t,n,r,a){return o.apply(this,arguments)})},LuBb:function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("7+uW"),a=(n("tvR6"),n("Dd8w")),u=n.n(a),i={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-menu",{attrs:{collapse:e.isCollapse,"default-active":e.$route.path}},[n("el-menu-item",{attrs:{index:"/browse"},on:{click:function(t){return e.itemClick("/browse")}}},[n("i",{staticClass:"el-icon-mobile-phone"}),e._v(" "),n("span",{attrs:{slot:"title"},slot:"title"},[e._v("文件列表")])]),e._v(" "),n("el-menu-item",{attrs:{index:"/history"},on:{click:function(t){return e.itemClick("/history")}}},[n("i",{staticClass:"el-icon-time"}),e._v(" "),n("span",{attrs:{slot:"title"},slot:"title"},[e._v("浏览历史")])]),e._v(" "),n("el-menu-item",{attrs:{index:"/downloads"},on:{click:function(t){return e.itemClick("/downloads")}}},[n("i",{staticClass:"el-icon-download"}),e._v(" "),n("span",{attrs:{slot:"title"},slot:"title"},[e._v("下载记录")])]),e._v(" "),n("el-menu-item",{attrs:{index:"/uploads"},on:{click:function(t){return e.itemClick("/uploads")}}},[n("i",{staticClass:"el-icon-upload2"}),e._v(" "),n("span",{attrs:{slot:"title"},slot:"title"},[e._v("上传记录")])]),e._v(" "),n("el-menu-item",{attrs:{index:"/settings"},on:{click:function(t){return e.itemClick("/settings")}}},[n("i",{staticClass:"el-icon-setting"}),e._v(" "),n("span",{attrs:{slot:"title"},slot:"title"},[e._v("设置")])])],1)},staticRenderFns:[]};var s=n("VU/8")({name:"MenuBar",data:function(){return{isCollapse:!0}},methods:{itemClick:function(e){this.$router.replace(e)}}},i,!1,function(e){n("gUnV")},"data-v-5e29923c",null).exports,o=n("NYxO"),c={name:"App",components:{MenuBar:s},data:function(){return{show_backup:!0,show_msg_box:!0}},created:function(){var e=this;document.title="File-Sharer",this.$alert("请勿在任何情况下刷新页面,否则上传/下载会暂停(下载进度也会消失),且需重新扫码!!!","温馨提示",{showClose:!1,center:!0,confirmButtonText:"确定并进入",callback:function(t){e.show_msg_box=!1,e.$router.replace("/browse")}})},methods:u()({},Object(o.b)(["PAUSE_ALL_UPLOAD_HISTORY"])),destroyed:function(){}},d={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("div",[this.show_msg_box?this._e():t("el-container",[t("el-header",{attrs:{height:"40px"}},[this._v("File-Sharer")]),this._v(" "),t("el-container",[t("el-aside",{attrs:{width:"65px"}},[t("menu-bar")],1),this._v(" "),t("el-main",[t("router-view")],1)],1)],1)],1)])},staticRenderFns:[]};var l=n("VU/8")(c,d,!1,function(e){n("LuBb")},null,null).exports,_=n("/ocq");r.default.use(_.a);var f=_.a.prototype.push;_.a.prototype.push=function(e){return f.call(this,e).catch(function(e){})};var p=_.a.prototype.replace;_.a.prototype.replace=function(e){return p.call(this,e).catch(function(e){})};var h,m,O,v=new _.a({routes:[{path:"/",redirect:"/browse"},{path:"/browse",name:"Browse",component:function(){return n.e(0).then(n.bind(null,"10yi"))}},{path:"/history",name:"History",component:function(){return n.e(3).then(n.bind(null,"bSHD"))}},{path:"/downloads",name:"Downloads",component:function(){return n.e(2).then(n.bind(null,"kcPi"))}},{path:"/uploads",name:"Uploads",component:function(){return n.e(1).then(n.bind(null,"Ir6P"))}},{path:"/settings",name:"Settings",component:function(){return n.e(4).then(n.bind(null,"EXBt"))}}],mode:"history"}),b=n("Xxa5"),k=n.n(b),A=n("Gu7T"),D=n.n(A),E=n("exGp"),T=n.n(E),x=n("mvHQ"),w=n.n(x),y={set:function(e,t){localStorage.setItem(e,t)},get:function(e){return localStorage.getItem(e)},remove:function(e){localStorage.removeItem(e)},clear:function(){localStorage.clear()},BROWSE_PARAMS:"fileSharer_browse_params",BROWSE_HISTORY:"fileSharer_browse_history",DOWNLOAD_HISTORY:"fileSharer_download_history",UPLOAD_HISTORY:"fileSharer_upload_history"},I=n("59kE"),L=n("0RrJ"),S=(h=T()(k.a.mark(function e(t,n,r,a,u,i,s){var o,c,d,l=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=l?"/upload/"+t+"?hit_log=true":"/upload/"+t,(c=new FormData).append("secret_key",n),c.append("ciphertext",r),c.append("file",a),c.append("file_name",u),c.append("chunk_id",i),c.append("curr_path",s),e.next=10,L.a.post(o,c,{headers:{"Content-Type":"multipart/form-data"}});case 10:if(200==(d=e.sent).errno){e.next=13;break}return e.abrupt("return",{succed:!1,data:d.errmsg});case 13:return e.abrupt("return",{succed:!0,data:d.errmsg});case 14:case"end":return e.stop()}},e,this)})),function(e,t,n,r,a,u,i){return h.apply(this,arguments)}),R=(m=T()(k.a.mark(function e(t,n,r,a,u,i){var s,o;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(s=new FormData).append("secret_key",n),s.append("ciphertext",r),s.append("file_name",a),s.append("chunk_count",u),s.append("curr_path",i),e.next=8,L.a.post("/upload/merge/"+t,s,{headers:{"Content-Type":"multipart/form-data"}});case 8:if(200==(o=e.sent).errno){e.next=11;break}return e.abrupt("return",{succed:!1,data:o.errmsg});case 11:return e.abrupt("return",{succed:!0,data:o.errmsg});case 12:case"end":return e.stop()}},e,this)})),function(e,t,n,r,a,u){return m.apply(this,arguments)}),U=(O=T()(k.a.mark(function e(t,n,r,a,u){var i,s;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(i=new FormData).append("secret_key",n),i.append("ciphertext",r),i.append("file_name",a),i.append("curr_path",u),e.next=7,L.a.post("/upload/remove/"+t,i,{headers:{"Content-Type":"multipart/form-data"}});case 7:if(s=e.sent,console.log(s),200==s.errno){e.next=11;break}return e.abrupt("return",{succed:!1,data:s.errmsg});case 11:return e.abrupt("return",{succed:!0,data:s.errmsg});case 12:case"end":return e.stop()}},e,this)})),function(e,t,n,r,a){return O.apply(this,arguments)}),P=n("pFYg"),g=n.n(P);function M(e){if("object"!==(void 0===e?"undefined":g()(e))||null===e)return e;var t=void 0;if(Array.isArray(e)){t=[];for(var n=0;n<e.length;n++)t.push(M(e[n]))}else for(var r in t={},e)e.hasOwnProperty(r)&&(t[r]=M(e[r]));return t}function W(e){if(null==e)return e;for(var t=[],n=0;n<e.length;n++){var r=M(e[n]);r.merged?r.succed_chunks=new Array(r.chunk_count).fill(0):r.succed_chunks=[],t.push(r)}return t}function H(e,t){var n=new Blob(e),r=document.createElement("a"),a=window.URL.createObjectURL(n);r.href=a,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a)}function Y(e){if(null==e)return e;for(var t=[],n=0;n<e.length;n++){var r=M(e[n]);r.file=null,t.push(r)}return t}r.default.use(o.a);var N=new o.a.Store({strict:!1,state:{browse_params:JSON.parse(y.get(y.BROWSE_PARAMS)),browse_history:JSON.parse(y.get(y.BROWSE_HISTORY)),download_history:JSON.parse(y.get(y.DOWNLOAD_HISTORY)),upload_history:JSON.parse(y.get(y.UPLOAD_HISTORY))},mutations:{SET_BROWSE_PARAMS:function(e,t){e.browse_params=t,y.set(y.BROWSE_PARAMS,w()(t))},SET_BROWSE_HISTORY:function(e,t){e.browse_history=t,y.set(y.BROWSE_HISTORY,w()(t))},UPDATE_BROWSE_HISTORY:function(e,t){var n=e.browse_history;if(null==n)n=[t];else{var r=n.findIndex(function(e){return e.uuid==t.uuid});-1!=r?n.splice(r,1,t):n.push(t)}e.browse_history=n,y.set(y.BROWSE_HISTORY,w()(n))},REMOVE_BROWSE_HISTORY:function(e,t){var n=e.browse_history;if(null!=n){var r=n.findIndex(function(e){return e.uuid==t});-1!=r&&(n.splice(r,1),e.browse_history=n,y.set(y.BROWSE_HISTORY,w()(n)))}},CLEAR_BROWSE_HISTORY:function(e){e.browse_history=null,y.remove(y.BROWSE_HISTORY)},UPDATE_DOWNLOAD_HISTORY:function(e,t){var n=e.download_history;if(null==n)n=[t];else{var r=n.findIndex(function(e){return e.uuid==t.uuid});-1!=r?n.splice(r,1,t):n.push(t)}e.download_history=n;var a=W(n);y.set(y.DOWNLOAD_HISTORY,w()(a))},UPDATE_DOWNLOAD_ITEM:function(e,t){var n=e.download_history;if(null!=n){var r=t.uuid,a=t.data,i=n.findIndex(function(e){return e.uuid==r});if(-1!=i){var s=u()({},e.download_history[i],a);n.splice(i,1,s)}e.download_history=n;var o=W(n);y.set(y.DOWNLOAD_HISTORY,w()(o))}},PAUSE_DOWNLOAD_ITEM:function(e,t){var n=e.download_history;if(null!=n){var r=n.findIndex(function(e){return e.uuid==t});if(-1!=r){n[r].is_pause=!0,e.download_history=n;var a=W(n);y.set(y.DOWNLOAD_HISTORY,w()(a))}}},REMOVE_DOWNLOAD_ITEM:function(e,t){var n=e.download_history;if(null!=n){var r=n.findIndex(function(e){return e.uuid==t});if(-1!=r){n.splice(r,1),e.download_history=n;var a=W(n);y.set(y.DOWNLOAD_HISTORY,w()(a))}}},PAUSE_ALL_DOWNLOAD_HISTORY:function(e){var t=e.download_history;if(null!=t){t.forEach(function(e){e.merged||(e.is_pause=!0)}),e.download_history=t;var n=W(t);y.set(y.DOWNLOAD_HISTORY,w()(n))}},CLEAR_DOWNLOAD_HISTORY:function(e){e.download_history=null,y.remove(y.DOWNLOAD_HISTORY)},UPDATE_UPLOAD_HISTORY:function(e,t){var n=e.upload_history;if(null==n)n=[t];else{var r=n.findIndex(function(e){return e.file_id==t.file_id});-1!=r?n.splice(r,1,t):n.push(t)}e.upload_history=n;var a=Y(n);y.set(y.UPLOAD_HISTORY,w()(a))},UPDATE_UPLOAD_ITEM:function(e,t){var n=e.upload_history;if(null!=n){var r=t.file_id,a=t.data,i=n.findIndex(function(e){return e.file_id==r});if(-1!=i){var s=u()({},e.upload_history[i],a);n.splice(i,1,s)}e.upload_history=n;var o=Y(n);y.set(y.UPLOAD_HISTORY,w()(o))}},PAUSE_UPLOAD_ITEM:function(e,t){var n=e.upload_history;if(null!=n){var r=n.findIndex(function(e){return e.file_id==t});if(-1!=r){n[r].is_pause=!0,e.upload_history=n;var a=Y(n);y.set(y.UPLOAD_HISTORY,w()(a))}}},REMOVE_UPLOAD_ITEM:function(e,t){var n=e.upload_history;if(null!=n){var r=n.findIndex(function(e){return e.file_id==t});if(-1!=r){n.splice(r,1),e.upload_history=n;var a=Y(n);y.set(y.UPLOAD_HISTORY,w()(a))}}},PAUSE_ALL_UPLOAD_HISTORY:function(e){var t=e.upload_history;if(null!=t){t.forEach(function(e){e.merged||(e.is_pause=!0)}),e.upload_history=t;var n=Y(t);y.set(y.UPLOAD_HISTORY,w()(n))}},CLEAR_UPLOAD_HISTORY:function(e){e.upload_history=null,y.remove(y.UPLOAD_HISTORY)}},actions:{START_DOWNLOAD_FILE:function(e,t){var n=this;return T()(k.a.mark(function r(){var a,u,i,s,o,c,d;return k.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(a=e.state.download_history)){n.next=3;break}return n.abrupt("return");case 3:if(void 0!=(u=a.findIndex(function(e){return e.uuid==t}))){n.next=6;break}return n.abrupt("return");case 6:i=a[u],e.commit("UPDATE_DOWNLOAD_ITEM",{uuid:t,data:{succed_chunks:[]}}),s=0;case 10:if(!(s<i.chunk_count)){n.next=25;break}if(!e.state.download_history[u].is_pause){n.next=13;break}return n.abrupt("return");case 13:return o=s*i.chunk_size,c=Math.min(o+i.chunk_size,i.file_size),n.next=17,Object(I.a)(i.uuid,i.secret_key,i.pwd,o,c,0==s);case 17:if((d=n.sent).succed){n.next=21;break}return e.commit("UPDATE_DOWNLOAD_ITEM",{uuid:t,data:{failed:!0}}),n.abrupt("return");case 21:e.commit("UPDATE_DOWNLOAD_ITEM",{uuid:t,data:{succed_chunks:[].concat(D()(e.state.download_history[u].succed_chunks),[d.data])}});case 22:s++,n.next=10;break;case 25:H(e.state.download_history[u].succed_chunks,i.file_name),e.commit("UPDATE_DOWNLOAD_ITEM",{uuid:t,data:{merged:!0,succed_chunks:new Array(i.chunk_count).fill(0)}});case 28:case"end":return n.stop()}},r,n)}))()},REDOWNLOAD_FILE:function(e,t){var n=this;return T()(k.a.mark(function r(){var a,u,i,s,o,c,d;return k.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(a=e.state.download_history)){n.next=3;break}return n.abrupt("return");case 3:if(void 0!=(u=a.findIndex(function(e){return e.uuid==t}))){n.next=6;break}return n.abrupt("return");case 6:(i=a[u]).failed&&e.commit("UPDATE_DOWNLOAD_ITEM",{uuid:t,data:{failed:!1}}),e.commit("UPDATE_DOWNLOAD_ITEM",{uuid:t,data:{is_pause:!1}}),s=i.succed_chunks.length;case 11:if(!(s<i.chunk_count)){n.next=26;break}if(!e.state.download_history[u].is_pause){n.next=14;break}return n.abrupt("return");case 14:return o=s*i.chunk_size,c=Math.min(o+i.chunk_size,i.file_size),n.next=18,Object(I.a)(i.uuid,i.secret_key,i.pwd,o,c);case 18:if((d=n.sent).succed){n.next=22;break}return e.commit("UPDATE_DOWNLOAD_ITEM",{uuid:t,data:{failed:!0}}),n.abrupt("return");case 22:e.commit("UPDATE_DOWNLOAD_ITEM",{uuid:t,data:{succed_chunks:[].concat(D()(e.state.download_history[u].succed_chunks),[d.data])}});case 23:s++,n.next=11;break;case 26:H(e.state.download_history[u].succed_chunks,i.file_name),e.commit("UPDATE_DOWNLOAD_ITEM",{uuid:t,data:{merged:!0,succed_chunks:new Array(i.chunk_count).fill(0)}});case 28:case"end":return n.stop()}},r,n)}))()},START_UPLOAD_FILE:function(e,t){var n=this;return T()(k.a.mark(function r(){var a,u,i,s,o,c,d;return k.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(a=e.state.upload_history)){n.next=3;break}return n.abrupt("return");case 3:if(void 0!=(u=a.findIndex(function(e){return e.file_id==t}))){n.next=6;break}return n.abrupt("return");case 6:if(null!=(i=a[u]).file){n.next=10;break}return e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{failed:!0}}),n.abrupt("return");case 10:e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{succed_chunks:[]}}),s=0;case 12:if(!(s<i.chunk_count)){n.next=28;break}if(!e.state.upload_history[u].is_pause){n.next=15;break}return n.abrupt("return");case 15:return o=s*i.chunk_size,c=Math.min(o+i.chunk_size,i.file_size),d=i.file.slice(o,c),n.next=20,S(i.uuid,i.secret_key,i.pwd,d,i.file_name,s,i.curr_path,0==s);case 20:if(n.sent.succed){n.next=24;break}return e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{failed:!0}}),n.abrupt("return");case 24:e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{succed_chunks:[].concat(D()(e.state.upload_history[u].succed_chunks),[s])}});case 25:s++,n.next=12;break;case 28:return n.next=31,R(i.uuid,i.secret_key,i.pwd,i.file_name,i.chunk_count,i.curr_path);case 31:if(n.sent.succed){n.next=35;break}return e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{failed:!0}}),n.abrupt("return");case 35:e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{merged:!0,file:null}});case 36:case"end":return n.stop()}},r,n)}))()},REUPLOAD_FILE:function(e,t){var n=this;return T()(k.a.mark(function r(){var a,u,i,s,o,c,d;return k.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(a=e.state.upload_history)){n.next=3;break}return n.abrupt("return");case 3:if(void 0!=(u=a.findIndex(function(e){return e.file_id==t}))){n.next=6;break}return n.abrupt("return");case 6:if(null!=(i=a[u]).file){n.next=10;break}return e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{failed:!0}}),n.abrupt("return");case 10:s=i.succed_chunks.length;case 11:if(!(s<i.chunk_count)){n.next=27;break}if(!e.state.upload_history[u].is_pause){n.next=14;break}return n.abrupt("return");case 14:return o=s*i.chunk_size,c=Math.min(o+i.chunk_size,i.file_size),d=i.file.slice(o,c),n.next=19,S(i.uuid,i.secret_key,i.pwd,d,i.file_name,s,i.curr_path,0==s);case 19:if(n.sent.succed){n.next=23;break}return e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{failed:!0}}),n.abrupt("return");case 23:e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{succed_chunks:[].concat(D()(e.state.upload_history[u].succed_chunks),[s])}});case 24:s++,n.next=11;break;case 27:return n.next=30,R(i.uuid,i.secret_key,i.pwd,i.file_name,i.chunk_count,i.curr_path);case 30:if(n.sent.succed){n.next=34;break}return e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{failed:!0}}),n.abrupt("return");case 34:e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{merged:!0,file:null}});case 35:case"end":return n.stop()}},r,n)}))()},REMOVE_UPLOAD_FILE:function(e,t){var n=this;return T()(k.a.mark(function r(){var a,u,i;return k.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(a=e.state.upload_history)){n.next=3;break}return n.abrupt("return");case 3:if(void 0!=(u=a.findIndex(function(e){return e.file_id==t}))){n.next=6;break}return n.abrupt("return");case 6:if((i=a[u]).merged||0==i.succed_chunks.length){n.next=10;break}return n.next=10,U(i.uuid,i.secret_key,i.pwd,i.file_name,i.curr_path);case 10:e.commit("REMOVE_UPLOAD_ITEM",i.file_id);case 11:case"end":return n.stop()}},r,n)}))()}},modules:{}}),B=(n("Qbok"),n("zL8q"));r.default.config.productionTip=!1,r.default.use(B.Menu),r.default.use(B.MenuItem),r.default.use(B.Container),r.default.use(B.Header),r.default.use(B.Aside),r.default.use(B.Main),r.default.use(B.Button),r.default.use(B.ButtonGroup),r.default.use(B.Table),r.default.use(B.TableColumn),r.default.use(B.Alert),r.default.use(B.Icon),r.default.use(B.Progress),r.default.use(B.MessageBox),r.default.use(B.Message),r.default.use(B.Loading),r.default.prototype.$alert=B.MessageBox.alert,r.default.prototype.$prompt=B.MessageBox.prompt,r.default.prototype.$confirm=B.MessageBox.confirm,r.default.prototype.$message=B.Message,new r.default({el:"#app",router:v,store:N,components:{App:l},template:"<App/>"})},Qbok:function(e,t){},gUnV:function(e,t){},tvR6:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.b6c39e4f33016f3634d0.js.map
