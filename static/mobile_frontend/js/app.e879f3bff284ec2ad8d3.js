webpackJsonp([6],{"0RrJ":function(e,t,r){"use strict";var n=r("mtWM").a.create({baseURL:"http://127.0.0.1",timeout:5e3});n.interceptors.request.use(function(e){return e},function(e){return e}),n.interceptors.response.use(function(e){return e.data},function(e){return e}),t.a=n},"59kE":function(e,t,r){"use strict";t.b=function(e){return i.a.get("/file_size/"+e)},r.d(t,"a",function(){return c});var n=r("Xxa5"),a=r.n(n),u=r("exGp"),s=r.n(u),i=r("0RrJ");var o,c=(o=s()(a.a.mark(function e(t,r,n,u,s){var o,c,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=d?"/download/"+t+"?hit_log=true":"/download/"+t,e.next=3,i.a.post(o,{secret_key:r,ciphertext:n},{headers:{Range:"bytes="+u+"-"+s},responseType:"blob"});case 3:if(void 0==(c=e.sent).errno){e.next=6;break}return e.abrupt("return",{succed:!1,data:c.errmsg});case 6:if(!(!c instanceof Blob)){e.next=8;break}return e.abrupt("return",{succed:!1,data:"后端异常, 返回非预期数据类型"});case 8:return e.abrupt("return",{succed:!0,data:c});case 9:case"end":return e.stop()}},e,this)})),function(e,t,r,n,a){return o.apply(this,arguments)})},M3BZ:function(e,t){},NHnr:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("7+uW"),a=(r("tvR6"),r("Dd8w")),u=r.n(a),s={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-menu",{attrs:{collapse:e.isCollapse,"default-active":e.$route.path}},[r("el-menu-item",{attrs:{index:"/browse"},on:{click:function(t){return e.itemClick("/browse")}}},[r("i",{staticClass:"el-icon-mobile-phone"}),e._v(" "),r("span",{attrs:{slot:"title"},slot:"title"},[e._v("文件列表")])]),e._v(" "),r("el-menu-item",{attrs:{index:"/history"},on:{click:function(t){return e.itemClick("/history")}}},[r("i",{staticClass:"el-icon-time"}),e._v(" "),r("span",{attrs:{slot:"title"},slot:"title"},[e._v("浏览历史")])]),e._v(" "),r("el-menu-item",{attrs:{index:"/downloads"},on:{click:function(t){return e.itemClick("/downloads")}}},[r("i",{staticClass:"el-icon-download"}),e._v(" "),r("span",{attrs:{slot:"title"},slot:"title"},[e._v("下载记录")])]),e._v(" "),r("el-menu-item",{attrs:{index:"/uploads"},on:{click:function(t){return e.itemClick("/uploads")}}},[r("i",{staticClass:"el-icon-upload2"}),e._v(" "),r("span",{attrs:{slot:"title"},slot:"title"},[e._v("上传记录")])]),e._v(" "),r("el-menu-item",{attrs:{index:"/settings"},on:{click:function(t){return e.itemClick("/settings")}}},[r("i",{staticClass:"el-icon-setting"}),e._v(" "),r("span",{attrs:{slot:"title"},slot:"title"},[e._v("设置")])])],1)},staticRenderFns:[]};var i=r("VU/8")({name:"MenuBar",data:function(){return{isCollapse:!0}},methods:{itemClick:function(e){this.$router.replace(e)}}},s,!1,function(e){r("gUnV")},"data-v-5e29923c",null).exports,o=r("NYxO"),c={name:"App",components:{MenuBar:i},data:function(){return{show_backup:!0,show_msg_box:!0}},created:function(){var e=this;this.PAUSE_ALL_DOWNLOAD_HISTORY(),this.PAUSE_ALL_UPLOAD_HISTORY(),document.title="File-Sharer",this.$alert("请勿在任何情况下刷新页面,否则上传/下载会暂停(下载进度也会消失),且需重新扫码!!!","温馨提示",{showClose:!1,center:!0,confirmButtonText:"确定并进入",callback:function(t){e.show_msg_box=!1,e.$router.replace("/browse")}})},methods:u()({},Object(o.c)(["PAUSE_ALL_DOWNLOAD_HISTORY","PAUSE_ALL_UPLOAD_HISTORY"]))},d={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("div",[this.show_msg_box?this._e():t("el-container",[t("el-header",{attrs:{height:"40px"}},[this._v("File-Sharer")]),this._v(" "),t("el-container",[t("el-aside",{attrs:{width:"65px"}},[t("menu-bar")],1),this._v(" "),t("el-main",[t("router-view")],1)],1)],1)],1)])},staticRenderFns:[]};var l=r("VU/8")(c,d,!1,function(e){r("M3BZ")},null,null).exports,_=r("/ocq");n.default.use(_.a);var f=_.a.prototype.push;_.a.prototype.push=function(e){return f.call(this,e).catch(function(e){})};var p=_.a.prototype.replace;_.a.prototype.replace=function(e){return p.call(this,e).catch(function(e){})};var h,m,O,v=new _.a({routes:[{path:"/",redirect:"/browse"},{path:"/browse",name:"Browse",component:function(){return r.e(0).then(r.bind(null,"10yi"))}},{path:"/history",name:"History",component:function(){return r.e(3).then(r.bind(null,"bSHD"))}},{path:"/downloads",name:"Downloads",component:function(){return r.e(1).then(r.bind(null,"kcPi"))}},{path:"/uploads",name:"Uploads",component:function(){return r.e(2).then(r.bind(null,"Ir6P"))}},{path:"/settings",name:"Settings",component:function(){return r.e(4).then(r.bind(null,"EXBt"))}}],mode:"history"}),A=r("Xxa5"),D=r.n(A),k=r("Gu7T"),E=r.n(k),b=r("exGp"),T=r.n(b),w=r("gRE1"),y=r.n(w),L=r("mvHQ"),S=r.n(L),R={set:function(e,t){localStorage.setItem(e,t)},get:function(e){return localStorage.getItem(e)},remove:function(e){localStorage.removeItem(e)},clear:function(){localStorage.clear()},BROWSE_PARAMS:"fileSharer_browse_params",BROWSE_HISTORY:"fileSharer_browse_history",DOWNLOAD_HISTORY:"fileSharer_download_history",UPLOAD_HISTORY:"fileSharer_upload_history"},x=r("59kE"),I=r("0RrJ"),U=(h=T()(D.a.mark(function e(t,r,n,a,u,s,i){var o,c,d,l=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return D.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=l?"/upload/"+t+"?hit_log=true":"/upload/"+t,(c=new FormData).append("secret_key",r),c.append("ciphertext",n),c.append("file",a),c.append("file_name",u),c.append("chunk_id",s),c.append("curr_path",i),e.next=10,I.a.post(o,c,{headers:{"Content-Type":"multipart/form-data"}});case 10:if(200==(d=e.sent).errno||4006==d.errno){e.next=13;break}return e.abrupt("return",{succed:!1,data:d.errmsg});case 13:return e.abrupt("return",{succed:!0,data:d.errmsg});case 14:case"end":return e.stop()}},e,this)})),function(e,t,r,n,a,u,s){return h.apply(this,arguments)}),P=(m=T()(D.a.mark(function e(t,r,n,a,u,s){var i,o;return D.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(i=new FormData).append("secret_key",r),i.append("ciphertext",n),i.append("file_name",a),i.append("chunk_count",u),i.append("curr_path",s),e.next=8,I.a.post("/upload/merge/"+t,i,{headers:{"Content-Type":"multipart/form-data"}});case 8:if(200==(o=e.sent).errno){e.next=11;break}return e.abrupt("return",{succed:!1,data:o.errmsg});case 11:return e.abrupt("return",{succed:!0,data:o.errmsg});case 12:case"end":return e.stop()}},e,this)})),function(e,t,r,n,a,u){return m.apply(this,arguments)}),g=(O=T()(D.a.mark(function e(t,r,n,a,u){var s,i;return D.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(s=new FormData).append("secret_key",r),s.append("ciphertext",n),s.append("file_name",a),s.append("curr_path",u),e.next=7,I.a.post("/upload/remove/"+t,s,{headers:{"Content-Type":"multipart/form-data"}});case 7:if(i=e.sent,console.log(i),200==i.errno){e.next=11;break}return e.abrupt("return",{succed:!1,data:i.errmsg});case 11:return e.abrupt("return",{succed:!0,data:i.errmsg});case 12:case"end":return e.stop()}},e,this)})),function(e,t,r,n,a){return O.apply(this,arguments)}),M=r("pFYg"),H=r.n(M);function W(e){if("object"!==(void 0===e?"undefined":H()(e))||null===e)return e;var t=void 0;if(Array.isArray(e)){t=[];for(var r=0;r<e.length;r++)t.push(W(e[r]))}else for(var n in t={},e)e.hasOwnProperty(n)&&(t[n]=W(e[n]));return t}function Y(e){if(null==e)return e;var t={};return y()(e).forEach(function(e){var r=W(e);r.merged?r.succed_chunks=new Array(r.chunk_count).fill(0):r.succed_chunks=[],t[r.uuid]=r}),t}function N(e,t){var r=new Blob(e),n=document.createElement("a"),a=window.URL.createObjectURL(r);n.href=a,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a)}function B(e){if(null==e)return e;var t={};return y()(e).forEach(function(e){var r=W(e);r.file=null,t[r.file_id]=r}),t}n.default.use(o.a);var C=new o.a.Store({strict:!1,state:{browse_params:JSON.parse(R.get(R.BROWSE_PARAMS)),browse_history:JSON.parse(R.get(R.BROWSE_HISTORY)),download_history:JSON.parse(R.get(R.DOWNLOAD_HISTORY)),upload_history:JSON.parse(R.get(R.UPLOAD_HISTORY))},mutations:{SET_BROWSE_PARAMS:function(e,t){e.browse_params=t,R.set(R.BROWSE_PARAMS,S()(t))},SET_BROWSE_HISTORY:function(e,t){e.browse_history=t,R.set(R.BROWSE_HISTORY,S()(t))},UPDATE_BROWSE_HISTORY:function(e,t){var r=e.browse_history;if(null==r)r=[t];else{var n=r.findIndex(function(e){return e.uuid==t.uuid});-1!=n?r.splice(n,1,t):r.push(t)}e.browse_history=r,R.set(R.BROWSE_HISTORY,S()(r))},REMOVE_BROWSE_HISTORY:function(e,t){var r=e.browse_history;if(null!=r){var n=r.findIndex(function(e){return e.uuid==t});-1!=n&&(r.splice(n,1),e.browse_history=r,R.set(R.BROWSE_HISTORY,S()(r)))}},CLEAR_BROWSE_HISTORY:function(e){e.browse_history=null,R.remove(R.BROWSE_HISTORY)},UPDATE_DOWNLOAD_HISTORY:function(e,t){var r=e.download_history;null==r&&(r={}),n.default.set(r,t.uuid,t),e.download_history=r;var a=Y(r);R.set(R.DOWNLOAD_HISTORY,S()(a))},UPDATE_DOWNLOAD_ITEM:function(e,t){var r=e.download_history;if(null!=r){var a=t.uuid,s=t.data,i=r[a];if(void 0!=i){var o=u()({},i,s);n.default.set(r,a,o)}e.download_history=r;var c=Y(r);R.set(R.DOWNLOAD_HISTORY,S()(c))}},PAUSE_DOWNLOAD_ITEM:function(e,t){var r=e.download_history;if(null!=r){var n=r[t];if(void 0!=n){n.is_pause=!0,e.download_history=r;var a=Y(r);R.set(R.DOWNLOAD_HISTORY,S()(a))}}},REMOVE_DOWNLOAD_ITEM:function(e,t){var r=e.download_history;if(null!=r&&void 0!=r[t]){n.default.delete(r,t),e.download_history=r;var a=Y(r);R.set(R.DOWNLOAD_HISTORY,S()(a))}},PAUSE_ALL_DOWNLOAD_HISTORY:function(e){var t=e.download_history;if(null!=t){y()(t).forEach(function(e){e.is_pause=!0}),e.download_history=t;var r=Y(t);R.set(R.DOWNLOAD_HISTORY,S()(r))}},CLEAR_DOWNLOAD_HISTORY:function(e){e.download_history=null,R.remove(R.DOWNLOAD_HISTORY)},UPDATE_UPLOAD_HISTORY:function(e,t){var r=e.upload_history;null==r&&(r={}),n.default.set(r,t.file_id,t),e.upload_history=r;var a=B(r);R.set(R.UPLOAD_HISTORY,S()(a))},UPDATE_UPLOAD_ITEM:function(e,t){var r=e.upload_history;if(null!=r){var a=t.file_id,s=t.data,i=r[a];if(void 0!=i){var o=u()({},i,s);n.default.set(r,a,o)}e.upload_history=r;var c=B(r);R.set(R.UPLOAD_HISTORY,S()(c))}},PAUSE_UPLOAD_ITEM:function(e,t){var r=e.upload_history;if(null!=r){var n=r[t];if(void 0!=n){n.is_pause=!0,e.upload_history=r;var a=B(r);R.set(R.UPLOAD_HISTORY,S()(a))}}},REMOVE_UPLOAD_ITEM:function(e,t){var r=e.upload_history;if(null!=r&&void 0!=r[t]){n.default.delete(r,t),e.upload_history=r;var a=B(r);R.set(R.UPLOAD_HISTORY,S()(a))}},PAUSE_ALL_UPLOAD_HISTORY:function(e){var t=e.upload_history;if(null!=t){y()(t).forEach(function(e){e.is_pause=!0}),e.upload_history=t;var r=B(t);R.set(R.UPLOAD_HISTORY,S()(r))}},CLEAR_UPLOAD_HISTORY:function(e){e.upload_history=null,R.remove(R.UPLOAD_HISTORY)}},actions:{START_DOWNLOAD_FILE:function(e,t){var r=this;return T()(D.a.mark(function n(){var a,u,s,i,o,c;return D.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=(a=e.state.download_history)&&void 0!=a[t]){r.next=3;break}return r.abrupt("return");case 3:u=a[t],e.commit("UPDATE_DOWNLOAD_ITEM",{uuid:t,data:{succed_chunks:[]}}),s=0;case 6:if(!(s<u.chunk_count)){r.next=21;break}if(!e.state.download_history[t].is_pause){r.next=9;break}return r.abrupt("return");case 9:return i=s*u.chunk_size,o=Math.min(i+u.chunk_size,u.file_size),r.next=13,Object(x.a)(u.uuid,u.secret_key,u.pwd,i,o,0==s);case 13:if((c=r.sent).succed){r.next=17;break}return e.commit("UPDATE_DOWNLOAD_ITEM",{uuid:t,data:{failed:!0,err_msg:c.data}}),r.abrupt("return");case 17:e.commit("UPDATE_DOWNLOAD_ITEM",{uuid:t,data:{succed_chunks:[].concat(E()(e.state.download_history[t].succed_chunks),[c.data])}});case 18:s++,r.next=6;break;case 21:N(e.state.download_history[t].succed_chunks,u.file_name),e.commit("UPDATE_DOWNLOAD_ITEM",{uuid:t,data:{merged:!0,succed_chunks:new Array(u.chunk_count).fill(0)}});case 24:case"end":return r.stop()}},n,r)}))()},REDOWNLOAD_FILE:function(e,t){var r=this;return T()(D.a.mark(function n(){var a,u,s,i,o,c;return D.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=(a=e.state.download_history)&&void 0!=a[t]){r.next=3;break}return r.abrupt("return");case 3:u=a[t],e.commit("UPDATE_DOWNLOAD_ITEM",{uuid:t,data:{failed:!1,err_msg:"",is_pause:!1}}),s=u.succed_chunks.length;case 6:if(!(s<u.chunk_count)){r.next=21;break}if(!e.state.download_history[t].is_pause){r.next=9;break}return r.abrupt("return");case 9:return i=s*u.chunk_size,o=Math.min(i+u.chunk_size,u.file_size),r.next=13,Object(x.a)(u.uuid,u.secret_key,u.pwd,i,o);case 13:if((c=r.sent).succed){r.next=17;break}return e.commit("UPDATE_DOWNLOAD_ITEM",{uuid:t,data:{failed:!0,err_msg:c.data}}),r.abrupt("return");case 17:e.commit("UPDATE_DOWNLOAD_ITEM",{uuid:t,data:{succed_chunks:[].concat(E()(e.state.download_history[t].succed_chunks),[c.data])}});case 18:s++,r.next=6;break;case 21:N(e.state.download_history[t].succed_chunks,u.file_name),e.commit("UPDATE_DOWNLOAD_ITEM",{uuid:t,data:{merged:!0,succed_chunks:new Array(u.chunk_count).fill(0)}});case 23:case"end":return r.stop()}},n,r)}))()},START_UPLOAD_FILE:function(e,t){var r=this;return T()(D.a.mark(function n(){var a,u,s,i,o,c,d,l;return D.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=(a=e.state.upload_history)&&void 0!=a[t]){r.next=3;break}return r.abrupt("return");case 3:if(null!=(u=a[t]).file){r.next=7;break}return e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{failed:!0,err_msg:"选择的文件数据丢失"}}),r.abrupt("return");case 7:e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{succed_chunks:[],failed:!1}}),s=0;case 9:if(!(s<u.chunk_count)){r.next=25;break}if(!e.state.upload_history[t].is_pause){r.next=12;break}return r.abrupt("return");case 12:return i=s*u.chunk_size,o=Math.min(i+u.chunk_size,u.file_size),c=u.file.slice(i,o),r.next=17,U(u.uuid,u.secret_key,u.pwd,c,u.file_name,s,u.curr_path,0==s);case 17:if((d=r.sent).succed){r.next=21;break}return e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{failed:!0,err_msg:d.data}}),r.abrupt("return");case 21:e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{succed_chunks:[].concat(E()(e.state.upload_history[t].succed_chunks),[s])}});case 22:s++,r.next=9;break;case 25:return r.next=28,P(u.uuid,u.secret_key,u.pwd,u.file_name,u.chunk_count,u.curr_path);case 28:if((l=r.sent).succed){r.next=32;break}return e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{failed:!0,err_msg:l.data}}),r.abrupt("return");case 32:e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{merged:!0,file:null}});case 33:case"end":return r.stop()}},n,r)}))()},REUPLOAD_FILE:function(e,t){var r=this;return T()(D.a.mark(function n(){var a,u,s,i,o,c,d,l;return D.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(console.log("REUPLOAD_FILE..."),null!=(a=e.state.upload_history)&&void 0!=a[t]){r.next=4;break}return r.abrupt("return");case 4:if(null!=(u=a[t]).file){r.next=8;break}return e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{failed:!0,err_msg:"选择的文件数据丢失"}}),r.abrupt("return");case 8:e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{failed:!1,err_msg:"",is_pause:!1}}),s=u.succed_chunks.length;case 10:if(!(s<u.chunk_count)){r.next=26;break}if(!e.state.upload_history[t].is_pause){r.next=13;break}return r.abrupt("return");case 13:return i=s*u.chunk_size,o=Math.min(i+u.chunk_size,u.file_size),c=u.file.slice(i,o),r.next=18,U(u.uuid,u.secret_key,u.pwd,c,u.file_name,s,u.curr_path,0==s);case 18:if((d=r.sent).succed){r.next=22;break}return e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{failed:!0,err_msg:d.data}}),r.abrupt("return");case 22:e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{succed_chunks:[].concat(E()(e.state.upload_history[t].succed_chunks),[s])}});case 23:s++,r.next=10;break;case 26:return r.next=29,P(u.uuid,u.secret_key,u.pwd,u.file_name,u.chunk_count,u.curr_path);case 29:if((l=r.sent).succed){r.next=33;break}return e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{failed:!0,err_msg:l.data}}),r.abrupt("return");case 33:e.commit("UPDATE_UPLOAD_ITEM",{file_id:t,data:{merged:!0,file:null}});case 34:case"end":return r.stop()}},n,r)}))()},REMOVE_UPLOAD_FILE:function(e,t){var r=this;return T()(D.a.mark(function n(){var a,u;return D.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=(a=e.state.upload_history)&&void 0!=a[t]){r.next=3;break}return r.abrupt("return");case 3:if((u=a[t]).merged||0==u.succed_chunks.length){r.next=7;break}return r.next=7,g(u.uuid,u.secret_key,u.pwd,u.file_name,u.curr_path);case 7:e.commit("REMOVE_UPLOAD_ITEM",u.file_id);case 8:case"end":return r.stop()}},n,r)}))()}},getters:{download_list:function(e){return e.download_history?y()(e.download_history):[]},upload_list:function(e){return e.upload_history?y()(e.upload_history):[]}},modules:{}}),z=(r("Qbok"),r("zL8q"));n.default.config.productionTip=!1,n.default.use(z.Menu),n.default.use(z.MenuItem),n.default.use(z.Container),n.default.use(z.Header),n.default.use(z.Aside),n.default.use(z.Main),n.default.use(z.Button),n.default.use(z.ButtonGroup),n.default.use(z.Table),n.default.use(z.TableColumn),n.default.use(z.Alert),n.default.use(z.Icon),n.default.use(z.Progress),n.default.use(z.MessageBox),n.default.use(z.Message),n.default.use(z.Loading),n.default.prototype.$alert=z.MessageBox.alert,n.default.prototype.$prompt=z.MessageBox.prompt,n.default.prototype.$confirm=z.MessageBox.confirm,n.default.prototype.$message=z.Message,new n.default({el:"#app",router:v,store:C,components:{App:l},template:"<App/>"})},Qbok:function(e,t){},gUnV:function(e,t){},tvR6:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.e879f3bff284ec2ad8d3.js.map
